<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    

<mapper namespace="web.dao.jobfair.face.JobFairDao">

	<sql id="selectJobfari">
		SELECT 
			jobfair_no, 
			jobfair_name, 
			TO_CHAR(sysdate, 'yyyy-MM-dd DAY') jobfair_date, 
			jobfair_start, 
			jobfair_end,
			jobfair_loc,
			jobfair_content,
			(SELECT SUBSTR(jobfair_limit, 1, (INSTR(jobfair_limit, ',')-1)) FROM dual) jobfair_limit1,
			(SELECT SUBSTR(jobfair_limit, (INSTR(jobfair_limit, ',')+1)) FROM dual) jobfair_limit2,
			member_no
		FROM jobfair
	</sql>

	<select id="selectAll" resultType="hashmap">
		SELECT * FROM jobfair
	</select>
	
	<select id="selectMap" resultType="web.dto.JobFair">
		SELECT * FROM jobfair
	</select>
	
	<select id="selectByJobfairNo" 
	parameterType="int"
	resultType="web.dto.JobFair">
		SELECT * FROM jobfair
		WHERE jobfair_no = #{jobfair_no }
	</select>
	
	<select id="selectByJobfairTitle" 
	parameterType="String"
	resultType="String">
		SELECT jobfair_name FROM jobfair
		WHERE jobfair_name LIKE '%'||#{jobfair_name, jdbcType=VARCHAR }||'%'
	</select>
	
	<insert id="insert" parameterType="web.dto.JobFair">
		INSERT INTO jobfair (
			jobfair_no, 
			jobfair_name, 
			jobfair_date, 
			jobfair_start, 
			jobfair_end,
			jobfair_loc,
			jobfair_content,
			jobfair_limit,
			member_no )
		VALUES (
			jobfair_seq.nextval, 
			#{jobfair_name, jdbcType=VARCHAR },
			SYSDATE, 
			#{jobfair_start, jdbcType=VARCHAR },
			#{jobfair_end, jdbcType=VARCHAR },
			#{jobfair_loc, jdbcType=VARCHAR },
			#{jobfair_content, jdbcType=VARCHAR },
			#{jobfair_limit, jdbcType=VARCHAR }, 
			#{member_no } )
			
		<selectKey resultType="int" keyProperty="jobfair_no" order="AFTER">
			SELECT jobfair_seq.currval FROM dual
		</selectKey>
	</insert>
	
	<update id="update" parameterType="web.dto.JobFair">
		UPDATE jobfair
		SET jobfair_name = #{jobfair_name, jdbcType=VARCHAR }, 
			jobfair_start = #{jobfair_start, jdbcType=VARCHAR },
			jobfair_end = #{jobfair_end, jdbcType=VARCHAR },
			jobfair_loc = #{jobfair_loc, jdbcType=VARCHAR },
			jobfair_content = #{jobfair_content, jdbcType=VARCHAR },
			jobfair_limit = #{jobfair_limit, jdbcType=VARCHAR }
		WHERE jobfair_no = #{jobfair_no }
	</update>
	
	<delete id="delete" parameterType="int">
		DELETE FROM jobfair
		WHERE jobfair_no = #{jobfair_no }
	</delete>
	
	
	<insert id="insertFile" parameterType="web.dto.JobFairFile">	
		INSERT INTO jobfair_file (
			jobfair_file_no, 
			jobfair_file_storedname,
			jobfair_file_originname, 
			jobfair_file_upload_date,
			jobfair_no )
		VALUES (
			jobfair_file_seq.nextval, 
			#{jobfair_file_storedname, jdbcType=VARCHAR },
			#{jobfair_file_originname, jdbcType=VARCHAR },
			SYSDATE,
			#{jobfair_no} )	
			
		<selectKey resultType="int" keyProperty="jobfair_file_no" order="AFTER">
			SELECT jobfair_file_seq.currval FROM dual
		</selectKey>
	</insert>
	
	<select id="selectFilename"
	parameterType="int"
	resultType="String">
		SELECT jobfair_file_storedname 
		FROM jobfair_file
		WHERE jobfair_no = #{jobfair_no }
			AND jobfair_file_no = ( SELECT MAX(jobfair_file_no) FROM jobfair_file )
	</select>
	
	<delete id="deleteFile" parameterType="int">
		DELETE FROM jobfair_file
		WHERE jobfair_no = #{jobfair_no }
	</delete>
		
</mapper>


