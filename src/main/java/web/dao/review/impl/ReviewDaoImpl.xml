<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="web.dao.review.face.ReviewDao">
	<select id="selectCorno" parameterType="String" resultType="int">
		SELECT cor_no FROM cor
		WHERE cor_name = #{selectCor }
	</select>

	<insert id="insertReview" parameterType="web.dto.Review">
		INSERT INTO review
		 VALUES (review_no_seq.nextval, #{cor_no }, 0, #{review_tag }, #{review_title }, #{review_content }, 0, 0, SYSDATE)
	</insert>
	
	<select id="selectCor" parameterType="String" resultType="String">
		SELECT cor_name FROM cor
		WHERE cor_name = #{result }
	</select>
	
		
	<select id="selectCntAll" resultType="int">
		SELECT COUNT(*) FROM review
		ORDER BY review_no
	</select>
	
	<select id="selectReview" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, review.cor_no, cor.cor_name, review.review_title, review.review_tag, 
					review.review_recommended, review.review_hit, review.review_written_date, review.review_check, review.mem_no 
			FROM review, cor
			WHERE review.cor_no = cor.cor_no
			ORDER BY review_no DESC
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
		ORDER BY review_no DESC
	</select>
	
	<select id="selectReviewByTag" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, review.cor_no, cor.cor_name, review.review_title, review.review_tag, 
					review.review_recommended, review.review_hit, review.review_written_date, review.review_check, review.mem_no 
			FROM review, cor
			WHERE review.cor_no = cor.cor_no AND review_tag = #{tag }
			ORDER BY review_no DESC
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<select id="searchReview" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, review.cor_no, cor.cor_name, review.review_title, review.review_tag, 
					review.review_recommended, review.review_hit, review.review_written_date, review.review_check, review.mem_no
			FROM review, cor
			WHERE review.cor_no = cor.cor_no AND cor.cor_name = #{tag }
			ORDER BY review_no DESC
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<select id="selectViewList" parameterType="int" resultType="web.dto.Review">
		SELECT * FROM review
		WHERE review_no = #{reviewno }
	</select>
	
	<update id="addHit">
		UPDATE review
		SET review_hit = review_hit + 1
		WHERE review_no = #{reviewno }
	</update>
	
	<update id="addLike">
		UPDATE review
		SET review_recommended = review_recommended + 1
		WHERE review_no = #{reviewno }
	</update>
	
	<update id="minLike">
		UPDATE review
		SET review_recommended = review_recommended - 1
		WHERE review_no = #{reviewno }
	</update>
	
	<insert id="insertRecommend">
		INSERT INTO recommend
		VALUES(#{review_no }, #{mem_no }, #{recommend_check } + 1)
	</insert>
	
	<update id="addRecommend">
		UPDATE recommend
		SET recommend_check = recommend_check + 1
		WHERE mem_no = #{mem_no } AND review_no = #{review_no }
	</update>
	
	<update id="deleteRecommend">
		DELETE FROM recommend
		WHERE mem_no = #{mem_no } AND review_no = #{review_no }
	</update>
	
	<select id="selectLike" parameterType="int" resultType="int">
		SELECT review_recommended FROM review
		WHERE review_no = #{reviewno }
	</select>
	
	<select id="scanRecommend" parameterType="int" resultType="web.dto.Recommend">
		SELECT mem_no, review_no FROM recommend
		WHERE mem_no = #{mem_no }
	</select>
</mapper>