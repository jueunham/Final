<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="web.dao.review.face.ReviewDao">
	<select id="selectCorno" parameterType="String" resultType="int">
		SELECT cor_no FROM cor
		WHERE cor_name = #{selectCor }
	</select>

	<insert id="insertReview" parameterType="web.dto.Review">
		INSERT INTO review
		 VALUES (review_no_seq.nextval, #{cor_no }, 0, #{review_tag }, #{review_title }, #{review_content }, 0, 0, SYSDATE)
	</insert>
	
	<select id="selectCor" parameterType="String" resultType="String">
		SELECT cor_name FROM cor
		WHERE cor_name = #{result }
	</select>
	
		
	<select id="selectCntAll" resultType="int">
		SELECT COUNT(*) FROM review
		ORDER BY review_no
	</select>
	
	<select id="selectReview" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, cor.cor_name, review.review_title, review.review_tag FROM review, cor
			WHERE review.cor_no = cor.cor_no
			ORDER BY rnum
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<select id="selectReviewByTag" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, cor.cor_name, review.review_title, review.review_tag FROM review, cor
			WHERE review.cor_no = cor.cor_no AND review_tag = #{tag }
			ORDER BY rnum
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<select id="searchReview" resultType="hashmap">
		SELECT * FROM (
			SELECT rownum AS rnum, review.review_no, cor.cor_name, review.review_title, review.review_tag FROM review, cor
			WHERE review.cor_no = cor.cor_no AND review.review_tag LIKE '%' || #{keyword } || '%' 
			OR review.review_title LIKE '%' || #{keyword } || '%' 
			OR review.review_content LIKE '%' || #{keyword } || '%'
			ORDER BY rnum
		)
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
</mapper>